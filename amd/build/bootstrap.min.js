define(["jquery","core/log"],function(a,b){function c(){a(".dropdown-backdrop").remove(),a(g).each(function(){d(a(this)).removeClass("open")})}function d(b){var c,d=b.attr("data-target");return d||(d=b.attr("href"),d=d&&/#/.test(d)&&d.replace(/.*(?=#[^\s]*$)/,"")),c=d&&a(d),c&&c.length||(c=b.parent()),c}a(".h1").hide(),b.debug("Essential bootstrap AMD initialised"),a(function(){a.support.transition=function(){var a=function(){var a,b=document.createElement("bootstrap"),c={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(a in c)if(void 0!==b.style[a])return c[a]}();return a&&{end:a}}()});var e=function(b,c){this.$element=a(b),this.options=a.extend({},a.fn.collapse.defaults,c),this.options.parent&&(this.$parent=a(this.options.parent)),this.options.toggle&&this.toggle()};e.prototype={constructor:e,dimension:function(){var a=this.$element.hasClass("width");return a?"width":"height"},show:function(){console.log("collapse show 1");var b,c,d,e;if(console.log("collapse show transitioning: "+this.transitioning),!this.transitioning&&!this.$element.hasClass("in")){if(console.log("collapse show 2"),b=this.dimension(),c=a.camelCase(["scroll",b].join("-")),d=this.$parent&&this.$parent.find("> .accordion-group > .in"),console.log("collapse show 3"),d&&d.length){if(console.log("collapse show 4"),e=d.data("collapse"),e&&e.transitioning)return;d.collapse("hide"),e||d.data("collapse",null),console.log("collapse show 5")}this.$element[b](0),this.transition("addClass",a.Event("show"),"shown"),console.log("collapse show 6"),a.support.transition&&this.$element[b](this.$element[0][c]),console.log("collapse show 7")}},hide:function(){console.log("collapse hide: ");var b;!this.transitioning&&this.$element.hasClass("in")&&(b=this.dimension(),this.reset(this.$element[b]()),this.transition("removeClass",a.Event("hide"),"hidden"),this.$element[b](0),console.log("collapse hide transitioning: "+this.transitioning))},reset:function(a){console.log("collapse reset 1");var b=this.dimension();return this.$element.removeClass("collapse")[b](a||"auto")[0].offsetWidth,this.$element[null!==a?"addClass":"removeClass"]("collapse"),console.log("collapse reset 2"),this},transition:function(b,c,d){console.log("collapse transition 1");var e=this,f=function(){console.log("collapse transition complete 1"),"show"==c.type&&e.reset(),e.transitioning=0,e.$element.trigger(d),console.log("collapse transition complete 2")};console.log("collapse transition 2"),this.$element.trigger(c),console.log("collapse transition 3"),c.isDefaultPrevented()||(this.transitioning=1,this.$element[b]("in"),console.log("collapse transition 4"),console.log("collapse transition 4 - transition: "+a.support.transition),console.log("collapse transition 4 - transition end: "+a.support.transition.end),console.log("collapse transition 4 - hasClass(collapse): "+this.$element.hasClass("collapse")),a.support.transition&&this.$element.hasClass("collapse")?this.$element.one(a.support.transition.end,f):f(),console.log("collapse transition 5 element: "+JSON.stringify(this.$element)))},toggle:function(){console.log("collapse toggle: "+JSON.stringify(this.$element.hasClass("in"))),this[this.$element.hasClass("in")?"hide":"show"]()}};var f=a.fn.collapse;a.fn.collapse=function(b){return this.each(function(){var c=a(this),d=c.data("collapse"),f=a.extend({},a.fn.collapse.defaults,c.data(),"object"==typeof b&&b);d||c.data("collapse",d=new e(this,f)),"string"==typeof b&&d[b]()})},a.fn.collapse.defaults={toggle:!0},a.fn.collapse.Constructor=e,a.fn.collapse.noConflict=function(){return a.fn.collapse=f,this},a(document).on("click.collapse.data-api","[data-toggle=collapse]",function(b){var c,d=a(this),e=d.attr("data-target")||b.preventDefault()||(c=d.attr("href"))&&c.replace(/.*(?=#[^\s]+$)/,""),f=a(e).data("collapse")?"toggle":d.data();d[a(e).hasClass("in")?"addClass":"removeClass"]("collapsed"),console.log("collapse option : "+JSON.stringify(f)),a(e).collapse(f),console.log("collapse target1: "+d.attr("data-target")),console.log("collapse this   : "+JSON.stringify(d.data())),console.log("collapse target3: "+JSON.stringify(a(e).data("collapse")))});var g="[data-toggle=dropdown]",h=function(b){var c=a(b).on("click.dropdown.data-api",this.toggle);a("html").on("click.dropdown.data-api",function(){c.parent().removeClass("open")})};h.prototype={constructor:h,toggle:function(b){var e,f,g=a(this);if(!g.is(".disabled, :disabled"))return e=d(g),f=e.hasClass("open"),c(),f||("ontouchstart"in document.documentElement&&a('<div class="dropdown-backdrop"/>').insertBefore(a(this)).on("click",c),e.toggleClass("open")),g.focus(),!1},keydown:function(b){var c,e,f,h,i;if(/(38|40|27)/.test(b.keyCode)&&(c=a(this),b.preventDefault(),b.stopPropagation(),!c.is(".disabled, :disabled"))){if(f=d(c),h=f.hasClass("open"),!h||h&&27==b.keyCode)return 27==b.which&&f.find(g).focus(),c.click();e=a("[role=menu] li:not(.divider):visible a",f),e.length&&(i=e.index(e.filter(":focus")),38==b.keyCode&&i>0&&i--,40==b.keyCode&&i<e.length-1&&i++,~i||(i=0),e.eq(i).focus())}}};var f=a.fn.dropdown;a.fn.dropdown=function(b){return this.each(function(){var c=a(this),d=c.data("dropdown");d||c.data("dropdown",d=new h(this)),"string"==typeof b&&d[b].call(c)})},a.fn.dropdown.Constructor=h,a.fn.dropdown.noConflict=function(){return a.fn.dropdown=f,this},a(document).on("click.dropdown.data-api",c).on("click.dropdown.data-api",".dropdown form",function(a){a.stopPropagation()}).on("click.dropdown.data-api",g,h.prototype.toggle).on("keydown.dropdown.data-api",g+", [role=menu]",h.prototype.keydown)});